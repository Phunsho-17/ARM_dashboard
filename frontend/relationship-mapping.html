<!-- relationship-mapping.html -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Relationship Mapping</title>

  <!-- Bootstrap Icons -->
   <link rel="stylesheet" href="../css/sidebar.css">
   <link rel="stylesheet" href="../css/responsive.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css"/>
  <link rel="stylesheet" href="/css/analysis.css" />
  <link rel="stylesheet" href="/css/relationship-mapping.css" />
</head>
<body>
  <div class="miniScreenContainer">
  <h1>Please view in a larger device</h1>
</div>
  <div class="relationship-container">
    <!-- Sidebar -->
    <div class="sidebar-menu">
    <div class="sidebar-header">

      <a href="">
        <p class = "largeTitle">ARM Dashboard</p>
        <p class = "smallTitle">ARM</p></a>
      
    </div>
    <div class="sidebar-nav">
      <nav>
        <a href="Dashboard.html">
          <img src="image/home.png" class="icon" alt="Home" />
          <span>Dashboard</span>
        </a>
        <a href="relationship-mapping.html" class = "active">
          <img src="image/rm icon.png" class="icon" alt="Relationship Mapping" />
          <span>Relationship Mapping</span>
        </a>
        <a href="analysis.html">
          <img src="image/ai icon.png" class="icon" alt="Analysis" />
          <span>Analysis</span>
        </a>
        <a href="records.html">
          <img src="image/record icon.png" class="icon" alt="Citizen Record" />
          <span>Citizen Record</span>
        </a>
        <a href="audit.html">
          <img src="image/audit icon.png" class="icon" alt="Audit Log" />
          <span>Audit Log</span>
        </a>
      </nav>
  </div>
 <div class="sidebar-footer">
  <a href="userprofile.html">
    <img id="sidebarProfilePic" src="https://www.w3schools.com/howto/img_avatar.png" class="user-img" alt="User profile" />
    <p id="sidebarUsername">Username</p>
  </a>
</div>
  </div>

    <!-- Main content -->
    <div class="main-content">
      <div class="header">
        <h1>Relationship Mapping</h1>
        <p>Quick family tree generator</p>
      </div>

      <div class="search-section">
        <h2>Search Citizen</h2>
        <div class="search-form">
          <input id="cidInput" type="text" class="input-box" placeholder="Enter citizen ID to view family ties"/>
          <select id="degreeSelect" class="input-box degree-select">
            <option value="" selected disabled>Select Degree</option>
            <option value="1">1st Degree</option>
            <option value="2">2nd Degree</option>
            <option value="3">3rd Degree</option>
          </select>
          <button id="searchBtn" class="search-btn">
            <i class="bi bi-search"></i><span class="search-text">Search</span>
          </button>
        </div>
      </div>

      <!-- Tree action buttons -->
      <div class="tree-controls">
        <button id="zoomOut"  class="control-btn"><i class="bi bi-zoom-out"></i></button>
        <button id="zoomIn"   class="control-btn"><i class="bi bi-zoom-in"></i></button>
        <button id="saveImage" class="control-btn"><i class="bi bi-image"></i>Export Image</button>
      </div>

      <!-- Tree display -->
      <div id="familyTreeContainer"></div>

      <!-- Compact Detail Panel -->
      <div id="detailPanel" style="display:none; position:absolute; top:190px; right:30px; width:300px; border-radius:12px; background:#fff; box-shadow:0 6px 20px rgba(0,0,0,0.1); overflow:hidden; z-index:999;">
        <div style="background:#6559ff; padding:20px; text-align:center; color:#fff; position:relative;">
          <img id="detailPhoto" src="image/default-placeholder.jpg" style="width:80px; height:80px; border-radius:50%; border:3px solid white;"/>
          <h3 id="detailName" style="margin:10px 0 4px;">Full Name</h3>
          <p id="detailCID" style="font-size:14px; opacity:0.9;">CID</p>
          <button onclick="closeDetailCard()" style="position:absolute; top:10px; right:10px; background:none; border:none; color:white; font-size:20px;"><i class="bi bi-x-circle"></i></button>
        </div>
        <div style="padding:16px;">
          <h4 style="margin-bottom:10px;">Biography</h4>
          <p><strong>Date of Birth:</strong> <span id="detailDOB">-</span></p>
          <p><strong>Gender:</strong> <span id="detailGender">-</span></p>
          <hr/>
          <h4 style="margin-bottom:10px;">Parent’s Details</h4>
          <p><strong>Father’s Name:</strong> <span id="detailFather">-</span></p>
          <p><strong>Mother’s Name:</strong> <span id="detailMother">-</span></p>
          <a id="viewMoreBtn" href="#" style="margin-top:12px; display:block; background:#6559ff; color:white; text-align:center; padding:8px; border-radius:6px; text-decoration:none;">View more</a>
        </div>
      </div>

      <footer>
        © 2025 Anti-Corruption Commission of Bhutan. All rights reserved.
      </footer>
    </div>
  </div>

  <!-- Libraries -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

  <!-- Your Scripts -->
  <script src="script/sidebar.js"></script>
  <script src="script/relationship-mapping.js"></script>
<script>
  document.addEventListener("DOMContentLoaded", function () {
    // Load user info from localStorage
    const storedUser = JSON.parse(localStorage.getItem("user")) || {};
    const storedProfilePic = localStorage.getItem("profilePic");

    // Get sidebar elements
    const sidebarUsername = document.getElementById("sidebarUsername");
    const sidebarProfilePic = document.getElementById("sidebarProfilePic");

    // Set full name or fallback to username
    const displayName = storedUser.fullName || storedUser.username || "User";
    if (sidebarUsername) {
      sidebarUsername.textContent = displayName;
    }

    // Set profile image if available
    if (sidebarProfilePic && storedProfilePic) {
      sidebarProfilePic.src = storedProfilePic;
    }
  });
</script>

</body>
</html>
