<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>User Profile</title>
  <link rel="stylesheet" href="../css/sidebar.css">
  <link rel="stylesheet" href="../css/responsive.css">
  <link rel="stylesheet" href="/css/userprofile.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
</head>
<body>
  <div class="miniScreenContainer">
    <h1>Please view in a larger device</h1>
  </div>

  <div class="relationship-container">
    <div class="sidebar-menu">
      <div class="sidebar-header">
        <a href="">
          <p class="largeTitle">ARM Dashboard</p>
          <p class="smallTitle">ARM</p>
        </a>
      </div>
      <div class="sidebar-nav">
        <nav>
          <a href="Dashboard.html"><img src="image/home.png" class="icon" alt="Home" /><span>Dashboard</span></a>
          <a href="relationship-mapping.html"><img src="image/rm icon.png" class="icon" alt="Relationship Mapping" /><span>Relationship Mapping</span></a>
          <a href="analysis.html"><img src="image/ai icon.png" class="icon" alt="Analysis" /><span>Analysis</span></a>
          <a href="records.html"><img src="image/record icon.png" class="icon" alt="Citizen Record" /><span>Citizen Record</span></a>
          <a href="audit.html"><img src="image/audit icon.png" class="icon" alt="Audit Log" /><span>Audit Log</span></a>
        </nav>
      </div>

      <!-- Sidebar Footer -->
      <div class="sidebar-footer">
        <a href="userprofile.html">
          <img id="sidebarProfilePic" src="https://www.w3schools.com/howto/img_avatar.png" class="user-img" alt="User profile" />
          <p id="sidebarUsername">Username</p>
        </a>
      </div>
    </div>

    <div class="main-content">
      <div class="container">
        <h1>User Profile</h1>
        <div class="profile-section">

          <!-- Personal Information -->
          <div class="personal-info">
            <div class="header">
              <div>
                <h2>Personal Information</h2>
                <p>Update your personal information</p>
              </div>
              <button class="edit-btn" id="editSaveBtn"><i class="bi bi-pencil"></i> Edit</button>
            </div>

            <form id="profileForm">
              <div class="form-row">
                <div class="form-group">
                  <label>Full Name</label>
                  <input type="text" id="fullName" disabled />
                </div>
                <div class="form-group">
                  <label>Email</label>
                  <input type="email" id="email" disabled />
                </div>
              </div>

              <div class="form-row">
                <div class="form-group">
                  <label>Phone Number</label>
                  <input type="text" id="phone" disabled />
                </div>
                <div class="form-group">
                  <label>Department</label>
                  <input type="text" id="department" disabled />
                </div>
              </div>
            </form>
          </div>

          <!-- Profile Preview -->
          <div class="profile-preview">
            <h3>How your profile look in public</h3>
            <img src="https://www.w3schools.com/howto/img_avatar.png" alt="Profile" class="profile-pic" />
            <p class="username">Username</p>
            <p class="user-email">Username@gmail.com</p>
            <div class="btn-group">
              <button class="upload-btn">Upload Photo</button>
              <button class="remove-btn">Remove photo</button>
            </div>
          </div>

        </div>
      </div>
    </div>
  </div>

  <!-- Sidebar Script -->
  <script src="script/sidebar.js"></script>

  <!-- Main Script -->
  <script>
    document.addEventListener("DOMContentLoaded", function () {
      const uploadBtn = document.querySelector(".upload-btn");
      const removeBtn = document.querySelector(".remove-btn");
      const profilePic = document.querySelector(".profile-pic");
      const sidebarUsername = document.getElementById("sidebarUsername");
      const sidebarProfilePic = document.getElementById("sidebarProfilePic");

      const fileInput = document.createElement("input");
      fileInput.type = "file";
      fileInput.accept = "image/*";
      fileInput.style.display = "none";
      document.body.appendChild(fileInput);

      uploadBtn.addEventListener("click", () => fileInput.click());

      fileInput.addEventListener("change", () => {
        const file = fileInput.files[0];
        if (file) {
          const reader = new FileReader();
          reader.onload = function (e) {
            profilePic.src = e.target.result;
            localStorage.setItem("profilePic", e.target.result);
            sidebarProfilePic.src = e.target.result;
          };
          reader.readAsDataURL(file);
        }
      });

      removeBtn.addEventListener("click", () => {
        const defaultImage = "https://www.w3schools.com/howto/img_avatar.png";
        profilePic.src = defaultImage;
        sidebarProfilePic.src = defaultImage;
        localStorage.removeItem("profilePic");
      });

      const storedUser = JSON.parse(localStorage.getItem("user")) || {};

      const userData = {
        fullName: storedUser.fullName || storedUser.username || "Unknown",
        email: storedUser.email || "",
        phone: storedUser.contact || "",
        department: storedUser.department || ""
      };

      // Fill form fields
      document.getElementById("fullName").value = userData.fullName;
      document.getElementById("email").value = userData.email;
      document.getElementById("phone").value = userData.phone;
      document.getElementById("department").value = userData.department;

      // Fill public preview
      document.querySelector(".username").textContent = userData.fullName;
      document.querySelector(".user-email").textContent = userData.email;

      // Update sidebar name
      if (sidebarUsername) {
        sidebarUsername.textContent = userData.fullName;
      }

      // Update sidebar image if exists
      const storedProfilePic = localStorage.getItem("profilePic");
      if (storedProfilePic) {
        profilePic.src = storedProfilePic;
        sidebarProfilePic.src = storedProfilePic;
      }

      // Edit/save logic
      const editSaveBtn = document.getElementById("editSaveBtn");
      const form = document.getElementById("profileForm");
      const inputs = form.querySelectorAll("input");
      let isEditing = false;

      editSaveBtn.addEventListener("click", function (e) {
        e.preventDefault();
        if (!isEditing) {
          inputs.forEach(input => input.disabled = false);
          editSaveBtn.innerHTML = '<i class="bi bi-check-circle"></i> Save';
          isEditing = true;
        } else {
          if (confirm("Are you sure you want to save the changes?")) {
            // Get updated values
            userData.fullName = document.getElementById("fullName").value;
            userData.email = document.getElementById("email").value;
            userData.phone = document.getElementById("phone").value;
            userData.department = document.getElementById("department").value;

            // Update preview and sidebar
            document.querySelector(".username").textContent = userData.fullName;
            document.querySelector(".user-email").textContent = userData.email;
            if (sidebarUsername) {
              sidebarUsername.textContent = userData.fullName;
            }

            // âœ… Save updated data to localStorage
            localStorage.setItem("user", JSON.stringify({
              fullName: userData.fullName,
              email: userData.email,
              contact: userData.phone,
              department: userData.department
            }));

            // Disable inputs
            inputs.forEach(input => input.disabled = true);
            editSaveBtn.innerHTML = '<i class="bi bi-pencil"></i> Edit';
            isEditing = false;
          }
        }
      });
    });
  </script>
</body>
</html>
